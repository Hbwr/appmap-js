{
  "events": [
    {
      "id": 1,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "issue",
      "path": "app/models/api_key.rb",
      "lineno": 28,
      "static": true,
      "parameters": [
        {
          "name": "login",
          "class": "String",
          "object_id": 70342617628840,
          "value": "admin",
          "kind": "req"
        },
        {
          "name": "description",
          "class": "String",
          "object_id": 70342580224440,
          "value": "example api key",
          "kind": "key"
        },
        {
          "name": "encode",
          "class": "NilClass",
          "object_id": 8,
          "value": null,
          "kind": "key"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 2,
      "event": "call",
      "thread_id": 70342530023440,
      "sql_query": {
        "sql": "INSERT INTO \"api_keys\" (\"login\", \"description\") VALUES ('admin', 'example api key') RETURNING *",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 3,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 2,
      "elapsed": 0.0013
    },
    {
      "id": 4,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "encode",
      "path": "app/models/api_key.rb",
      "lineno": 20,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "DAO::ApiKey",
          "object_id": 70342635443280,
          "value": "#<DAO::ApiKey:0x00007ff3d798a8a0>",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 5,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 4,
      "elapsed": 0.000022,
      "return_value": {
        "class": "String",
        "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
        "object_id": 70342537401700
      }
    },
    {
      "id": 6,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 1,
      "elapsed": 0.004678,
      "return_value": {
        "class": "String",
        "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
        "object_id": 70342537401700
      }
    },
    {
      "id": 7,
      "event": "call",
      "thread_id": 70342530023440,
      "http_server_request": {
        "request_method": "DELETE",
        "path_info": "/api/api_keys",
        "normalized_path_info": "/api/api_keys(.:format)"
      },
      "message": [
        {
          "name": "controller",
          "class": "String",
          "value": "api/api_keys",
          "object_id": 70342617273180
        },
        {
          "name": "action",
          "class": "String",
          "value": "destroy",
          "object_id": 70342617275480
        }
      ]
    },
    {
      "id": 8,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "authenticate",
      "path": "app/models/api_key.rb",
      "lineno": 52,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70342537429640,
          "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 9,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "decode",
      "path": "app/models/api_key.rb",
      "lineno": 24,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70342537429640,
          "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 10,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 9,
      "elapsed": 0.000014,
      "return_value": {
        "class": "Array",
        "value": "[\"admin\", \"c4703bec-e0a4-4679-8fb9-40e1f7db4052\"]",
        "object_id": 70342558616760
      }
    },
    {
      "id": 11,
      "event": "call",
      "thread_id": 70342530023440,
      "sql_query": {
        "sql": "SELECT * FROM \"api_keys\" WHERE (\"login\" = 'admin')",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 12,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 11,
      "elapsed": 0.001354
    },
    {
      "id": 13,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "touch",
      "path": "app/models/api_key.rb",
      "lineno": 11,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "DAO::ApiKey",
          "object_id": 70342635632020,
          "value": "#<DAO::ApiKey:0x00007ff3d79e6b28>",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 14,
      "event": "call",
      "thread_id": 70342530023440,
      "sql_query": {
        "sql": "UPDATE \"api_keys\" SET \"last_used\" = '2021-02-01 15:52:48.011849+0000' WHERE (\"id\" = 3)",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 15,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 14,
      "elapsed": 0.001371
    },
    {
      "id": 16,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 13,
      "elapsed": 0.022899,
      "return_value": {
        "class": "DAO::ApiKey",
        "value": "#<DAO::ApiKey:0x00007ff3d79e6b28>",
        "object_id": 70342635632020
      }
    },
    {
      "id": 17,
      "event": "call",
      "thread_id": 70342530023440,
      "sql_query": {
        "sql": "SELECT * FROM \"users\" WHERE (\"users\".\"login\" = 'admin') LIMIT 1",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 18,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 17,
      "elapsed": 0.001451
    },
    {
      "id": 19,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 8,
      "elapsed": 0.034333,
      "return_value": {
        "class": "User::Show",
        "value": "#<User::Show:0x00007ff3d68c8760>",
        "object_id": 70342626657200
      }
    },
    {
      "id": 20,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "API::APIKeysController",
      "method_id": "destroy",
      "path": "app/controllers/api/api_keys_controller.rb",
      "lineno": 15,
      "static": false,
      "receiver": {
        "class": "API::APIKeysController",
        "object_id": 70342537416460,
        "value": "#<API::APIKeysController:0x00007ff3cbe91e18>"
      }
    },
    {
      "id": 21,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "revoke",
      "path": "app/models/api_key.rb",
      "lineno": 40,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70342537429640,
          "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 22,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "decode",
      "path": "app/models/api_key.rb",
      "lineno": 24,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70342537429640,
          "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 23,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 22,
      "elapsed": 0.000011,
      "return_value": {
        "class": "Array",
        "value": "[\"admin\", \"c4703bec-e0a4-4679-8fb9-40e1f7db4052\"]",
        "object_id": 70342626696460
      }
    },
    {
      "id": 24,
      "event": "call",
      "thread_id": 70342530023440,
      "sql_query": {
        "sql": "SELECT * FROM \"api_keys\" WHERE (\"login\" = 'admin')",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 25,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 24,
      "elapsed": 0.001071
    },
    {
      "id": 26,
      "event": "call",
      "thread_id": 70342530023440,
      "sql_query": {
        "sql": "DELETE FROM \"api_keys\" WHERE \"id\" = 3",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 27,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 26,
      "elapsed": 0.001253
    },
    {
      "id": 28,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 21,
      "elapsed": 0.010014,
      "return_value": {
        "class": "DAO::ApiKey",
        "value": "#<DAO::ApiKey:0x00007ff3d103a648>",
        "object_id": 70342580228900
      }
    },
    {
      "id": 29,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 20,
      "elapsed": 0.010242,
      "return_value": {
        "class": "String",
        "value": "",
        "object_id": 70342529845780
      }
    },
    {
      "id": 30,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 7,
      "elapsed": 0.045335,
      "http_server_response": {
        "status": 200,
        "mime_type": "application/json; charset=utf-8"
      }
    },
    {
      "id": 31,
      "event": "call",
      "thread_id": 70342530023440,
      "http_server_request": {
        "request_method": "DELETE",
        "path_info": "/api/api_keys",
        "normalized_path_info": "/api/api_keys(.:format)"
      },
      "message": [
        {
          "name": "controller",
          "class": "String",
          "value": "api/api_keys",
          "object_id": 70342617273180
        },
        {
          "name": "action",
          "class": "String",
          "value": "destroy",
          "object_id": 70342617275480
        }
      ]
    },
    {
      "id": 32,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "authenticate",
      "path": "app/models/api_key.rb",
      "lineno": 52,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70342539215260,
          "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 33,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "ApiKey",
      "method_id": "decode",
      "path": "app/models/api_key.rb",
      "lineno": 24,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70342539215260,
          "value": "YWRtaW46YzQ3MDNiZWMtZTBhNC00Njc5LThmYjktNDBlMWY3ZGI0MDUy",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70342537284160,
        "value": "ApiKey"
      }
    },
    {
      "id": 34,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 33,
      "elapsed": 0.00001,
      "return_value": {
        "class": "Array",
        "value": "[\"admin\", \"c4703bec-e0a4-4679-8fb9-40e1f7db4052\"]",
        "object_id": 70342539228120
      }
    },
    {
      "id": 35,
      "event": "call",
      "thread_id": 70342530023440,
      "sql_query": {
        "sql": "SELECT * FROM \"api_keys\" WHERE (\"login\" = 'admin')",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 36,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 35,
      "elapsed": 0.001161
    },
    {
      "id": 37,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 32,
      "elapsed": 0.004864
    },
    {
      "id": 38,
      "event": "call",
      "thread_id": 70342530023440,
      "defined_class": "JSON::Ext::Generator::State",
      "method_id": "generate",
      "path": "JSON::Ext::Generator::State#generate",
      "static": false,
      "parameters": [
        {
          "name": "arg",
          "class": "Hash",
          "object_id": 70342626915040,
          "value": "{\"error\"=>\"must provide authorization\"}",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "JSON::Ext::Generator::State",
        "object_id": 70342626915000,
        "value": "#<JSON::Ext::Generator::State:0x00007ff3d6946570>"
      }
    },
    {
      "id": 39,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 38,
      "elapsed": 0.000021,
      "return_value": {
        "class": "String",
        "value": "{\"error\":\"must provide authorization\"}",
        "object_id": 70342626913440
      }
    },
    {
      "id": 40,
      "event": "return",
      "thread_id": 70342530023440,
      "parent_id": 31,
      "elapsed": 0.005674,
      "http_server_response": {
        "status": 401,
        "mime_type": "application/json; charset=utf-8"
      }
    }
  ],
  "version": "1.4",
  "metadata": {
    "app": "appland/AppLand",
    "language": {
      "name": "ruby",
      "engine": "ruby",
      "version": "2.6.6"
    },
    "client": {
      "name": "appmap",
      "url": "https://github.com/getappmap/appmap-ruby",
      "version": "0.40.0"
    },
    "frameworks": [
      {
        "name": "rails",
        "version": "5.2.4.2"
      },
      {
        "name": "rspec",
        "version": "3.9.1"
      }
    ],
    "git": {
      "repository": "git@github.com:getappmap/appland.git",
      "branch": "apply-labels",
      "commit": "5428f5df16a93d59a15d2559c626f6918d8f0523",
      "status": [
        "M app/controllers/api/scenarios_controller.rb",
        "M app/controllers/application_controller.rb",
        "M app/controllers/applications_controller.rb",
        "M app/controllers/concerns/current_user.rb",
        "M app/controllers/home_controller.rb",
        "M app/controllers/js/examples_controller.rb",
        "M app/controllers/profile_filters_controller.rb",
        "M app/controllers/scenario_uploads_controller.rb",
        "M app/controllers/scenarios_controller.rb",
        "M app/controllers/sessions_controller.rb",
        "M app/controllers/setup_controller.rb",
        "M app/controllers/static_controller.rb",
        "M app/controllers/web_resources_controller.rb",
        "M appmap.yml"
      ],
      "git_last_annotated_tag": null,
      "git_last_tag": "v0.17.1",
      "git_commits_since_last_annotated_tag": null,
      "git_commits_since_last_tag": 0
    },
    "name": "API::APIKeysController revoke an existing api key",
    "feature": "API::APIKeysController revoke",
    "feature_group": "API API keys",
    "labels": [
      "api_keys",
      "api"
    ],
    "recorder": {
      "name": "rspec"
    },
    "fingerprints": [
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "classDependencies",
        "digest": "1122a143a6173e05866ee95629372b94c56c54e41024a3b0d02fb2e58ca382e1",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "classes",
        "digest": "9717f0de0c287764b0504895124418e6360e6114c62ea49cef434943127325b1",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "httpClientRequests",
        "digest": "4f53cda18c2baa0c0354bb5f9a3ecbe5ed12ab4d8e11ba873c2f11161202b945",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "httpServerRequests",
        "digest": "a11f7966c704cc09de820a3d9a8b0890cff8944090079498a0fd891fd06e9626",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "info",
        "digest": "464335ce01d8bf49b1b7d491e8945e6a341acc290f73b3e6e4e4c5d9ca026b6e",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "labels",
        "digest": "cbe2b872bc3cf917b59bdcde4123086b6ce504508ad7deecb52e6ebbfcc2723e",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "packageDependencies",
        "digest": "3f108b0a9ca874a5bc90a30f48da9b068269e0a91d01d3eb4d2af3fe25cb09f3",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "packages",
        "digest": "174dff39ae750e61f0eac4933a745eb8059c7e2a98a1c94c34f722037c80a468",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "sqlNormalized",
        "digest": "3e2a2e51ceef49123a28b3c6ceba2d11932340072e81ed1f0dddebdc35eeb345",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "sqlTables",
        "digest": "e51dc158c171357be7b1424c172b7a9a33f853d43e7cafb2fd676976e69d52fe",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "trace",
        "digest": "f1b7353d79444cc945b2f960dc0b830b88e75e8c0a9e387baad4113d4b0c9ba1",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "6d4ff270d2b91048c75b8e441deab98f9ab00b296c708c5e204b55571a88d78e",
        "canonicalization_algorithm": "update",
        "digest": "7bf5c5c41ce8561cf8b535bd7fee0b307de013842bf5f735f1e5e195ddbcc707",
        "fingerprint_algorithm": "sha256"
      }
    ]
  },
  "classMap": [
    {
      "name": "app/models",
      "type": "package",
      "children": [
        {
          "name": "ApiKey",
          "type": "class",
          "children": [
            {
              "name": "issue",
              "type": "function",
              "static": true,
              "location": "app/models/api_key.rb:28"
            },
            {
              "name": "encode",
              "type": "function",
              "static": true,
              "location": "app/models/api_key.rb:20"
            },
            {
              "name": "authenticate",
              "type": "function",
              "labels": [
                "provider.authentication"
              ],
              "static": true,
              "location": "app/models/api_key.rb:52"
            },
            {
              "name": "decode",
              "type": "function",
              "static": true,
              "location": "app/models/api_key.rb:24"
            },
            {
              "name": "touch",
              "type": "function",
              "static": true,
              "location": "app/models/api_key.rb:11"
            },
            {
              "name": "revoke",
              "type": "function",
              "static": true,
              "location": "app/models/api_key.rb:40"
            }
          ]
        }
      ]
    },
    {
      "name": "app/controllers",
      "type": "package",
      "children": [
        {
          "name": "API",
          "type": "class",
          "children": [
            {
              "name": "APIKeysController",
              "type": "class",
              "children": [
                {
                  "name": "destroy",
                  "type": "function",
                  "static": false,
                  "location": "app/controllers/api/api_keys_controller.rb:15"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "json",
      "type": "package",
      "children": [
        {
          "name": "JSON",
          "type": "class",
          "children": [
            {
              "name": "Ext",
              "type": "class",
              "children": [
                {
                  "name": "Generator",
                  "type": "class",
                  "children": [
                    {
                      "name": "State",
                      "type": "class",
                      "children": [
                        {
                          "name": "generate",
                          "type": "function",
                          "labels": [
                            "serialization",
                            "json"
                          ],
                          "static": false,
                          "location": "JSON::Ext::Generator::State#generate"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "database",
      "name": "Database",
      "children": [
        {
          "type": "query",
          "name": "INSERT INTO \"api_keys\" (\"login\", \"description\") VALUES ('admin', 'example api key') RETURNING *"
        },
        {
          "type": "query",
          "name": "SELECT * FROM \"api_keys\" WHERE (\"login\" = 'admin')"
        },
        {
          "type": "query",
          "name": "UPDATE \"api_keys\" SET \"last_used\" = '2021-02-01 15:52:48.011849+0000' WHERE (\"id\" = 3)"
        },
        {
          "type": "query",
          "name": "SELECT * FROM \"users\" WHERE (\"users\".\"login\" = 'admin') LIMIT 1"
        },
        {
          "type": "query",
          "name": "DELETE FROM \"api_keys\" WHERE \"id\" = 3"
        }
      ]
    },
    {
      "type": "http",
      "name": "HTTP server requests",
      "children": [
        {
          "type": "route",
          "name": "DELETE /api/api_keys(.:format)"
        }
      ]
    }
  ]
}